<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Completed Tasks</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>Completed Tasks</h1>
    
    <div id="completedTaskList">
      <p>Loading completed tasks...</p>
    </div>
    <!-- Added class "taskButton" to the close button -->
    <button id="closeCompletedButton" class="taskButton">Close</button>
    <script>
      async function loadCompletedTasks() {
        const taskList = document.getElementById("completedTaskList");
        try {
          const tasks = await window.electronAPI.getCompletedTasks();
          taskList.innerHTML = "";
          if (!tasks || tasks.length === 0) {
            taskList.innerHTML = "<p>No completed tasks available.</p>";
            return;
          }
          tasks.sort(
            (a, b) => new Date(b.date_completed) - new Date(a.date_completed)
          );
          tasks.forEach((task) => {
            const taskRow = document.createElement("div");
            taskRow.classList.add("task-row");
            taskRow.innerHTML = `
            <span class="task-title">${task.title}</span>
            <span class="task-text">${task.description}</span>
            <span class="task-date">${new Date(
              task.date_completed
            ).toLocaleDateString()}</span>
            <button class="deleteButton" onclick="deleteCompletedTask('${
              task.id
            }')">üóëÔ∏è</button>
          `;
            taskList.appendChild(taskRow);
          });
        } catch (error) {
          console.error("Error loading completed tasks:", error);
          taskList.innerHTML = "<p>Failed to load completed tasks.</p>";
        }
      }

      async function deleteCompletedTask(taskId) {
        await window.electronAPI.deleteCompletedTask(taskId);
        loadCompletedTasks();
      }

      document
        .getElementById("closeCompletedButton")
        .addEventListener("click", () => {
          window.close();
        });

      document.addEventListener("DOMContentLoaded", loadCompletedTasks);
    </script>
  </body>
</html>
